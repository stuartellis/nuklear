
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

variables:
  - template: .azure-pipelines/variables.yml

name: ${{variables.name}}-pipeline

stages:
  - stage: run
    displayName: Run
    jobs:
    - job: run
      displayName: Setup and Run
      pool:
        vmImage: ${{variables.vmImage}}
      steps:
      - script: |
          ./do.sh setup
        displayName: 'Setup'
      - script: |
          ./do.sh info
        displayName: 'Info'
      - task: AWSShellScript@1
        displayName: 'Run'
        inputs:
          awsCredentials: 'sje-aws-labs'
          regionName: 'eu-west-1'
          scriptType: 'inline'
          inlineScript: ./do.sh headless-dryrun
          failOnStandardError: true
      - publish: log
        artifact: ${{variables.name}}-$(system.JobId)-logs 
